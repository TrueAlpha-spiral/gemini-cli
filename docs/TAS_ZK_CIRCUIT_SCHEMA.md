# TAS Zero-Knowledge (zk-SNARK) Circuit Schema: Sovereign Gene Broadcast

This document formally defines the arithmetic circuit schema ($C(x, w)$) for the `ZK_LedgerClient` to securely verify the "Prime Invariant" ($I_0$) without revealing the private `HumanSeed` or the raw prompt content.

The purpose of this circuit is to prove that a generated `VerifiedGene` ($G$) originated from a valid `HumanSeed` ($H$) anchored in the hardware enclave, and passed the "Refusal Integrity" check, without exposing the semantic content of $G$ or the private key of $H$.

## 1. Circuit Definition ($C$)

Let $C(x, w)$ be an arithmetic circuit over a finite field $\mathbb{F}_p$ (e.g., BN254 or BLS12-381 scalar field).

### Public Inputs ($x$)
These values are known to the verifier (the Immutable Truth Ledger).

| Variable | Symbol | Description | Type |
| :--- | :--- | :--- | :--- |
| `genesis_hash` | $H_0$ | The public anchor hash from the previous block (Merkle Root). | `Field` |
| `gene_hash` | $H_g$ | The hash of the verified output content ($G$). | `Field` |
| `verification_key` | $VK$ | The public verification key corresponding to the circuit. | `Point (G2)` |

### Private Inputs ($w$) - The Witness
These values are known only to the prover (the Local Kernel) and must remain hidden.

| Variable | Symbol | Description | Type |
| :--- | :--- | :--- | :--- |
| `human_seed_sk` | $sk$ | The private key from the simulated Secure Enclave. | `Scalar` |
| `raw_prompt` | $P$ | The original raw prompt content. | `Field[]` (bits/bytes) |
| `biometric_sig` | $\sigma$ | The ECDSA signature over $P$ generated by the enclave. | `(r, s)` |

## 2. Constraints (R1CS)

The circuit enforces the following constraints to generate a valid proof $\pi$:

1.  **Signature Verification**:
    $$VerifySignature(sk, P, \sigma) == True$$
    *   Ensures that $P$ was indeed signed by the holder of $sk$ (the hardware anchor).
    *   Uses standard ECDSA verification logic within the circuit.

2.  **Gene Hash Integrity**:
    $$Poseidon(P + H_0) == H_g$$
    *   Ensures that the public `gene_hash` ($H_g$) corresponds to the hashing of the private `raw_prompt` ($P$) combined with the public `genesis_hash` ($H_0$).
    *   This binds the current action to the historical chain without revealing the action itself.

3.  **Refusal Integrity Check (Simulated)**:
    *   Ideally, the circuit would also run a lightweight classifier or regex check on $P$ to prove it does not contain prohibited patterns (e.g., "violate"), mirroring the logic in `TriadicKnowledgeEngine`.
    *   For this schema, we assume this is handled by the kernel before proof generation, and the proof simply attests to the *provenance* of the result.

## 3. Proof Generation ($\pi$)

The `PersistentRootKernel` acts as the Prover.

1.  **Setup**: Generate Proving Key ($PK$) and Verification Key ($VK$) for $C$. (Trusted Setup phase).
2.  **Witness Generation**: Compute $w = \{sk, P, \sigma\}$ based on the current kernel state.
3.  **Prove**: Compute $\pi = Prove(PK, x, w)$.
    *   $\pi$ is a succinct proof (e.g., Groth16 or Plonk) typically ~200-400 bytes.

## 4. Broadcast

The `ZK_LedgerClient` broadcasts the tuple $\{H_0, H_g, \pi\}$ to the network. Verifiers check $Verify(VK, x, \pi)$ to accept the state transition.
